<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: query/condition/ConditionLexer.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: query/condition/ConditionLexer.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>'use strict';

require('insulin').factory('ndm_ConditionLexer',
  ['ndm_assert'], ndm_ConditionLexerProducer);

function ndm_ConditionLexerProducer(assert) {
  /** Class that lexicographically parses a condition into tokens. */
  class ConditionLexer {
    /**
     * Parse the sentence into tokens.
     * @param {string|object} condStr - The condition string to parse.  (If
     * condStr is an object it is converted to a string using JSON.stringify.
     * @return {Object[]} An array of tokens.  Each token object has the
     * following properties: terminal, which is a boolean indicating if the
     * token is a terminal or not; type, as described by the condition BNF;
     * and value.
     */
    parse(condStr) {
      // Make sure condStr is actually a string.  If it's an object, stringify it.
      if (typeof condStr === 'object')
        condStr = JSON.stringify(condStr);

      const len     = condStr.length;
      const tokens  = [];
      const boolOps = ['$and', '$or'];
      const compOps = ['$eq', '$neq', '$lt', '$lte', '$gt', '$gte', '$like', '$notLike'];
      const nullOps = ['$is', '$isnt'];

      let curChar = '';
      let str, nextQuote, nonNum;

      // Helper to add a token to the tokens array.
      function addToken(terminal, type, value) {
        tokens.push({terminal, type, value});
      }

      for (let i = 0; i &lt; len; ++i) {
        curChar = condStr[i];

        switch (curChar) {
          // Basic terminals.
          case '{':
          case '}':
          case '[':
          case ']':
          case ':':
          case ',':
            addToken(true, 'char', curChar);
            break;
          case '"':
            // Move past the quote.
            assert(++i &lt; condStr.length, 'Expected character but found EOL.');

            // The string immediatly after the quote, and the index of the next quote.
            str       = condStr.substring(i);
            nextQuote = str.indexOf('"');

            // No next quote - hit EOL.
            assert(nextQuote !== -1, 'Expected quote but found EOL.');

            // Looks good - store the actual string and advance the token pointer.
            str = str.substring(0, nextQuote);
            i  += nextQuote;

            // Store the appropriate token.
            if (boolOps.indexOf(str) !== -1)
              addToken(false, 'boolean-operator', str);
            else if (compOps.indexOf(str) !== -1)
              addToken(false, 'comparison-operator', str);
            else if (str === '$in')
              addToken(false, 'in-comparison-operator', str);
            else if (nullOps.indexOf(str) !== -1)
              addToken(false, 'null-comparison-operator', str);
            else if (str[0] === ':')
              addToken(true, 'parameter', str);
            else
              addToken(true, 'column', str);
            break;

          // Number.
          case '0':
          case '1':
          case '2':
          case '3':
          case '4':
          case '5':
          case '6':
          case '7':
          case '8':
          case '9':
          case '.':
          case '-':
            str = condStr.substring(i);

            // The first character that's not part of a number.
            nonNum = str.search(/[^0-9\.\-\+]+/);

            // Number continues to the end of the string.
            if (nonNum === -1)
              nonNum = str.length;

            // Pull the number, and advance the token pointer.
            str = str.substring(0, nonNum);
            i  += nonNum - 1;

            assert(!isNaN(Number(str)), `Expected number but found ${str}.`);
            addToken(true, 'number', Number(str));
            break;

          // Null.
          case 'n':
            str = condStr.substr(i, 4);
            assert(str === 'null', `Expected null but found ${str}.`);
            addToken(true, 'null', null);
            i += 3;
            break;

          // Anything else is invalid.
          default:
            throw new Error(`Unexpected character.  Found ${curChar}.`);
        }
      }

      return tokens;
    }
  }

  return ConditionLexer;
}

</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="BitConverter.html">BitConverter</a></li><li><a href="Column.html">Column</a></li><li><a href="ConditionCompiler.html">ConditionCompiler</a></li><li><a href="ConditionLexer.html">ConditionLexer</a></li><li><a href="ConditionParser.html">ConditionParser</a></li><li><a href="Database.html">Database</a></li><li><a href="DataContext.html">DataContext</a></li><li><a href="DataMapper.html">DataMapper</a></li><li><a href="Delete.html">Delete</a></li><li><a href="DeleteModel.html">DeleteModel</a></li><li><a href="Escaper.html">Escaper</a></li><li><a href="ForeignKey.html">ForeignKey</a></li><li><a href="From.html">From</a></li><li><a href="FromAdapter.html">FromAdapter</a></li><li><a href="Insert.html">Insert</a></li><li><a href="ModelTraverse.html">ModelTraverse</a></li><li><a href="MutateModel.html">MutateModel</a></li><li><a href="Query.html">Query</a></li><li><a href="QueryExecuter.html">QueryExecuter</a></li><li><a href="RelationshipStore.html">RelationshipStore</a></li><li><a href="Schema.html">Schema</a></li><li><a href="Select.html">Select</a></li><li><a href="Table.html">Table</a></li><li><a href="TableMetaList.html">TableMetaList</a></li><li><a href="Update.html">Update</a></li><li><a href="UpdateModel.html">UpdateModel</a></li><li><a href="UTCConverter.html">UTCConverter</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.4.2</a> on Sun Dec 04 2016 13:52:15 GMT-0800 (PST)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
